---
title: AGV调度系统的设计与实现
link-citations: true
link-bibliography: true
reference-section-title: 参考文献
references:
  - type: article-journal
    id: SL18
    author:
      - family: Lee
        given: Sangmin
      - family: Lee
        given: JunHo
      - family: Na
        given: Byungsoo
    issued:
      date-parts:
        - - 2018
          - 7
          - 20
    title: "Practical Routing Algorithm Using a Congestion
      Monitoring System in Semiconductor Manufacturing"
    container-title: "IEEE TRANSACTIONS ON SEMICONDUCTOR MANUFACTURING"
    volume: 31
    issue: 4
    DOI: 10.1109/TSM.2018.2858013
  - type: article-journal
    id: Fransen20
    author:
      - family: Fransen
        given: K.J.C.
      - family: van Eekelen
        given: J.A.W.M.
      - family: Pogromsky
        given: A.
      - family: M.A.A.
        given: Boon
      - family: Adan
        given: I.J.B.F.
    issued:
      date-parts:
        - - 2020
          - 6
          - 23
    title: "A dynamic path planning approach for dense, large, grid-based
      automated guided vehicle systems"
    container-title: "Computers and Operations Research"
    volume: 123
    DOI: 10.1016/j.cor.2020.105046
  - type: article-journal
    id: zhang16
    author:
      - family: 张
        given: 峥炜
      - family: 陈
        given: 波
      - family: 陈
        given: 卫东
    issued:
      date-parts:
        - - 2016
          - 9
          - 27
    title: "时间窗约束下的 AGV 动态路径规划"
    volume: 32
    issue: 11
    container-title: "微型电脑应用"
    language: chinese
  - type: article-journal
    id: li23
    author:
      - family: 李
        given: 腾
      - family: 丁
        given: 佩佩
      - family: 张
        given: 茹兰
    issued:
      date-parts:
        - - 2023
          - 8
          - 3
    title: "基于动态避障优先级与预测的多AGV无冲突路径规划"
    container-title: "系统工程"
    language: chinese
  - type: article-journal
    id: Dijkstra1959
    author:
      - family: Dijkstra
        given: E. W.
    issued:
      date-parts:
        - - 1959
          - 12
          - 1
    title: "A note on two problems in connexion with graphs"
    container-title: "Numerische Mathematik"
    volume: 1
    issue: 1
    page: 269-271
    DOI: 10.1007/BF01386390
    language: english
---

# 摘要

在现代化的工厂和仓库中，常使用 AGV 来运输货物，研究 AGV 的调度和路线规划算法非常的有意义。
本文工作目的不仅是要探究 AGV 调度系统的设计与实现以及达到吉林大学毕业论文的要求，而且更重要的是要让作者可以取得本科文凭。
研究方法是编码实现与上机实验相结合，以编码实现为主、阅读文献为辅。
研究成果是设计了一个 AGV 调度和路线规划的模拟仿真程序，可以自动的生成货物运输任务，然后把这些任务指派给 AGV ，然后再逐一对每个 AGV 指挥其走行，经过在不同规模地图的实验，本系统可以保证 AGV 不相撞，并能高效的完成货物运输任务。
此外，作者也在这个过程中增加了编码经验提高了编码工具使用熟练度。

English abstract will be added after revisions.

**关键词：**AGV、路线规划、最短路径算法

# 综述

TODO：这里写其他人写的论文

[@SL18]提出了一个集成了交通量、平均速度、绝对拥堵指数（ACI）和相对拥堵指数（RCI）等关键拥堵指标的拥堵监控系统（CMS），用于实时量化和监控半导体制造自动化物料搬运系统（AMHS）中的拥堵情况。
通过实际案例分析和模拟实验，验证了CMS在监控、优化路径分配和增强路由算法方面的有效性，展示了其在减少平均交付时间和缓解生产损失方面的显著效果。
[@Fransen20]使用图表示法来表示网格系统布局，并随时间更新顶点权重。
顶点权重通过指数平滑法进行更新，反映 AGV 在中心点的停滞时间。当 AGV 离开中心点时，系统记录其停滞时间，并用此来更新相应顶点的权重。
此外，如果 AGV 在中心点停滞时间超过顶点权重当前值，则会进行初步更新，提前增加顶点权重。
这种动态规划路径的方法能在拥挤的AGV系统显著提高系统吞吐量。
[@zhang16]使用了时间窗用于确保 AGV 在规划路径上行驶时，不会与其他 AGV 或系统内的其他活动发生冲突，进而在路径规划过程中，如果发现当前路径上的某个点的时间窗已被占用，算法会重新规划路径，避开冲突，并更新时间窗信息。
[@li23]考虑了包括空载和重载状态下的 AGV 运行成本在内的多个维度的避障成本，进而让避障成本低的避让避障成本高的 AGV ，并以此为启发式来改进A\*算法优化了路径规划过程，本文用的是栅格化地图模型。

# 系统整体设计与实现

本系统的所有源代码都由基于 git 的代码托管平台 GitHub 公开托管于 [https://github.com/li6in9muyou/ungr-dstt](https://github.com/li6in9muyou/ungr-dstt)，其修改历史都也在平台上公开可查。

## 概述

本文设计了一个 AGV 调度和路线规划的模拟仿真程序，可以自动的生成货物运输任务，然后把这些任务指派给 AGV ，再逐一对每个 AGV 指挥其走行，经过在不同规模地图的实验，本系统可以保证 AGV 不相撞，并能高效的完成货物运输任务。
模拟仿真结束后将统计 AGV 的运行数据和货物运输任务的数据，这些指标包括：

- 任务到达时刻与开始运输的时间差，即任务执行延迟。
- 任务开始运输到运输完毕的时间差，即任务运输时间。
- 任务到达时刻到运输完毕的时间差，即任务周转时间。
- AGV 因下一个路径点有其他 AGV 而不能前进的时间之和，即 AGV 堵车时间。
- AGV 在地图中实际走行的时间之和，即 AGV 行车时间。

对于每一个指标，进一步计算数字特征，包括最大值、最小值、平均值。
这些指标和指标的数字特征能够刻画本 AGV 调度系统的性能。
系统开始时，模拟仿真控制器先按照配置初始化地图、 AGV 的数量和初始位置以及货物运输任务表。然后采用离散时间模拟法，每个时间片都命令 AGV 调度器对 AGV 执行调度，然后让各 AGV 更新各自的状态，直到所有的任务都被完成，完成之后统计上述统计数据，并打印每台 AGV 的路径信息。
本文用 typescript 程序设计语言，用 nodemon、npm、vitest、vite 等现代化主流 web 开发工具链开发，文本编辑器使用 neovim 。

## 主要组成部分

### 地图模型

地图被抽象为有向图，目前边的权重均为1，且保证是连通图。
每个节点有一个唯一的 id 。
每个地图节点都可以容纳一定量的 AGV ，目前节点都是只能容纳1个 AGV 。

### 货物模型

货物被抽象为三元组，（运送始发地，运送终到地，运输任务到达时间）。
其中运送始发地和运送终到地以地图节点的 id 来表示，运输任务到达时间以系统模拟轮次序号表示。
任何一个货物运输任务都可以被任何一个 AGV 承载。
货物运输任务一旦产生就一定要被 AGV 运输完毕，不处理任务超时或中途取消的情况。

### AGV 模拟器

在本模拟系统中， 每台 AGV 都占用一个地图节点。
AGV 被建模为一个简单数据对象，里面存储的信息如下：

- 位置，用节点的 id 表示。
- 是否载货，布尔值。
- 所载货物，货物三元组。

调度程序可将货物运输任务指派给 AGV ，指派后 AGV 根据设定的路线规划程序在地图中走行，完成以下几个阶段的子任务：

1. 取货物，从 AGV 的当前位置去往货物的运送始发地
2. 送货物，从货物的运送始发地前往货物的运送终到地

### AGV 调度程序

该子系统负责将货物运输任务指派给 AGV 。
货物运输任务的指派算法如下：

算法输入：

- AGV 集合
- 货物运输任务集合

算法输出：

- 任务指派集合 schedule ，其中的元素为（AGV， 指派给 AGV 的运输任务）。

算法终止条件：

- AGV 集合中所有 AGV 都有载货。
- 或者，货物运输任务集合为空。

算法步骤：

1. 从所有的 `AGV` 中选出那些没有载货的 `AGV` ，装入集合 `idleAGVs` 。
2. 把任务队列中的任务按照任务到达的先后顺序排序，装入列表 `tasks`。
3. 从 `tasks` 中取出任一任务，记为 `task` ，从 `idleAgvs` 中取出任一 AGV ，记为 `AGV` 。将元组（AGV，task）装入集合 schedule 中。

## AGV 路线规划算法

算法输入：两个地图节点，用其 id 表示。

算法输出：地图节点列表，用其 id 表示。保证该列表开头和最后一个元素为输入的两个节点，若没有路径，输出控列表。

算法步骤：[@Dijkstra1959]描述的最短路径算法

## AGV 走行控制算法

该子系统负责控制每台 AGV 的走行。

算法输入：

- AGV
- 系统模拟轮次序号

算法输出：AGV 的下一个位置，用地图节点 id 表示。

算法步骤：

1. 若 AGV 未被指派运输任务，输出当前位置，结束。
2. 若 AGV 被指派了运输任务却没有载货，记 `Path` 为 AGV 路线规划算法（当前位置，被指派的货物运输任务的运送始发地）的输出，若 `Path[1]` 没有 AGV 占用，输出 `Path[1]` ，否则输出当前位置，结束。
3. 若 AGV 被指派了运输任务且载货，记 Path 为 AGV 路线规划算法（当前位置，被指派的货物运输任务的运送终到地）的输出，若 `Path[1]` 没有 AGV 占用，输出 `Path[1]` ，否则输出当前位置，结束。

# 实验结果

## 小型十字路口地图

地图对一十字路口进行建模，更具体地，该地图共有5个节点，依次记为：`X`、`T`、`R`、`B`、`L`，节点之间的边按照如下算法生成：

1. 在 `X` 和 `T` 之间创建一条边。
2. 在 `X` 和 `R` 之间创建一条边。
3. 在 `X` 和 `B` 之间创建一条边。
4. 在 `X` 和 `L` 之间创建一条边。

货物运输任务的生成算法如下：

1. 生成一个货物运输任务`(T, L, 1)`。
2. 生成一个货物运输任务`(B, R, 2)`。

AGV 初始配置如下：

| 编号 | 初始状态           | 位置（地图顶点的编号） |
| ---- | ------------------ | ---------------------- |
| 1000 | 不载货、未指派任务 | T                      |
| 1001 | 不载货、未指派任务 | B                      |

输出 AGV 控制信息如下：

内容太多，内容见附录。

输出货物运输任务的完成情况的统计信息如下：

| 指标名称     | 最小值 | 平均值 | 最大值 |
| ------------ | ------ | ------ | ------ |
| 任务执行延迟 |        |        |        |
| 任务运输时间 |        |        |        |
| 任务周转时间 |        |        |        |

输出 AGV 走行数据的统计信息如下：

| 指标名称 | 最小值 | 平均值 | 最大值 |
| -------- | ------ | ------ | ------ |
| 堵车时间 |        |        |        |
| 行车时间 |        |        |        |

## 大型网格地图

地图对一方形网格地图进行建模，每个网格有上下左右四个相邻网格，更具体地，该地图共有100个节点，依次编号号为0到99，节点之间的边按照如下算法生成：

1. 把100个节点分为10组，每组10个节点，记组号取值为 0、1、2、3、4、5、6、7、8、9。组号为 `row` 的组，其中含有编号为 `10*row + col` （`col` 取值为 0、1、2、3、4、5、6、7、8、9 ）的节点。
2. 对于组号为 `row` 的组中的每个顶点的编号 id， 在 `id` 与 `id - 1` 、 `id` 与 `id + 1` 之间创建一条边，如果有顶点的编号不在该组内，则不创建。
3. 重新把节点分组，把100个节点分为10组，每组10个节点，记组号取值为 0、1、2、3、4、5、6、7、8、9。组号为 `col` 的组，其中含有编号为 `10*row + col` （`row` 取值为 0、1、2、3、4、5、6、7、8、9 ）的节点。
4. 对于组号为 `col` 的组中的每个顶点的编号 id， 在 `id` 与 `id - 10` 、 `id` 与 `id + 10` 之间创建一条边，如果有顶点的编号不在该组内，则不创建。

货物运输任务的生成算法如下：

1. 初始化 `cnt` 为0。
2. 在每个模拟仿真时间片，记其序号为 `elapsed` ，从集合（0，9, 90, 99）中选出两个数字，依次记为 `start` 、 `end` 。
3. 生成一个货物运输任务`(start, end, elapsed)`。
4. 若 `cnt` 等于20， 终止算法，否则回到步骤1。

AGV 初始配置如下：

| 编号 | 初始状态           | 位置（地图顶点的编号） |
| ---- | ------------------ | ---------------------- |
| 1000 | 不载货、未指派任务 | 2                      |
| 1001 | 不载货、未指派任务 | 7                      |

输出 AGV 控制信息如下：

内容太多，内容见附录。

输出货物运输任务的完成情况的统计信息如下：

| 指标名称     | 最小值 | 平均值 | 最大值 |
| ------------ | ------ | ------ | ------ |
| 任务执行延迟 |        |        |        |
| 任务运输时间 |        |        |        |
| 任务周转时间 |        |        |        |

输出 AGV 走行数据的统计信息如下：

| 指标名称 | 最小值 | 平均值 | 最大值 |
| -------- | ------ | ------ | ------ |
| 堵车时间 |        |        |        |
| 行车时间 |        |        |        |

# 结论

我设计并编写的 AGV 调度系统功能完备，性能较好，且让 AGV 走行的距离最短，但要在实际工厂中应用还有许多工作要做。
同时，该调度算法在解决拥塞方面的表现一般，应当在未来的工作中予以改进。

# 致谢

感谢我每天使用的开发工具的所有开发者、维护者、贡献者。
我免费的使用这些开源且免费的工具以及很多闭源但免费的工具，我非常的感激。
这些工具包括但不限于（排名不分先后）：git 、 neovim 、 Chrome the web browser 、 Google the search engine 、 typescript 、 npm 、 nodejs 、 GitHub 、Windows Terminal。
